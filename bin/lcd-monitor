#!/usr/bin/perl
use strict;
use warnings;

my $DEVS = {
  lcd1 => [
    "pyeconet-lcd",
  ],
};

sub main(@){
  my @btnStrs = split /,/, `pico-lcd-msg --buttons`;
  my %btnCounts;
  for my $btnStr(@btnStrs){
    $btnCounts{$1} = $2 if $btnStr =~ /^\s*(\w+)\s*=\s*(\d+)\s*$/;
  }

  my $modeCount = 0;
  $modeCount = $btnCounts{B1} if defined $btnCounts{B1};
  $modeCount = $btnCounts{Y} if defined $btnCounts{Y};

  my @modes = @{$$DEVS{lcd1}};
  my $modeIndex = $modeCount % @modes;
  my $cmd = $modes[$modeIndex];
  system $cmd;
}

&main(@ARGV);
