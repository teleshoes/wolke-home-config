#!/usr/bin/perl
use strict;
use warnings;

#$ptrn23 = "##_P__PP_PP_PP__P__PP_____P__PPPPPP_P_PPPP_P_P____##_P__PP_PP_PP__P__PP_____P__PPPPPP_P_PPPP_P_P____";
#$ptrn24 = "##_P__PP_PP_PP__P__PP_____P__PPPPPP_PPPPPP_P______##_P__PP_PP_PP__P__PP_____P__PPPPPP_PPPPPP_P______";

my $CONST1 = '1011';
my $CONST2 = '0010';

my $TEMPS = {
  17   => '0000',
  18   => '0001',
  19   => '0011',
  20   => '0010',
  21   => '0110',
  22   => '0111',
  23   => '0101',
  24   => '0100',
  25   => '1100',
  26   => '1101',
  27   => '1001',
  28   => '1000',
  29   => '1010',
  30   => '1011',
  same => '1111',
  off  => '1110',
};

my $FANS = {
  auto => '1011',
  low  => '1001',
  med  => '0101',
  high => '0011',
  off  => '0111',
};

my $STATES = {
  on   => '1111',
  off  => '1011',
};

my $MODES = {
  auto => '1000',
  cool => '0000',
  heat => '1100',
  fan  => '0100',
  off  => '0000',
};

sub main(@){
  my $fan = $$FANS{low};
  my $temp = $$TEMPS{t23};
  my $mode = $$MODES{cool};
  my $state = $$STATES{off};

  my $bits = "";
  $bits .= $CONST1 . $CONST2 . inv($CONST1) . inv($CONST2);
  $bits .= $fan    . $state  . inv($fan)    . inv($state);
  $bits .= $temp   . $mode   . inv($temp)   . inv($mode);

  print "$bits\n";

  my $ptrn = "##$bits##$bits";
  $ptrn =~ s/0/_/g;
  $ptrn =~ s/1/X/g;
  $ptrn =~ s/_/space 500\npulse 500\n/g;
  $ptrn =~ s/X/space 1500\npulse 500\n/g;
  $ptrn =~ s/#/space 4000\npulse 4000\n/g;

  open FH, "> $ENV{HOME}/.config/iguana/remotes/midea_ac_MAW08V1QWT/buttons/test";
  print FH $ptrn;
  close FH;
}

sub inv($){
  my ($nibble) = @_;
  $nibble =~ s/0/one/g;
  $nibble =~ s/1/zero/g;
  $nibble =~ s/zero/0/g;
  $nibble =~ s/one/1/g;
  return $nibble;
}

&main(@ARGV);
