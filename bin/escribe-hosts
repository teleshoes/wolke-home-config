#!/usr/bin/perl
use strict;
use warnings;

my $HOSTS_FILE = '/etc/hosts';

my $escribe = {
  'source'    => '10.1.12.10',
  'trac'      => '10.1.12.11',
  'dev'       => '10.1.12.19',
  'stage'     => '10.1.13.12',
  'garuda'    => '10.1.11.11',
  'demo'      => '10.1.7.11',
  'demo-edge' => '10.1.7.12',
  'qa'        => '10.1.13.13',
  'datadict'  => '10.1.12.21',
  'cchit'     => '10.1.13.19',
  'proxy'     => '10.1.4.8',
};

open FH, "< $HOSTS_FILE" or die "Could not open $HOSTS_FILE for reading";
my @lines = <FH>;
close FH;

#remove lines like: '{IP}   {THING}.escribe.com\n'
for my $line(@lines){
  $line = '' if $line =~ /^ [0-9.]+ \t [^\.]* \.escribe\.com \n $/x;
}

for my $host(keys %$escribe){
  my $ip = $$escribe{$host};
  push @lines, "$ip\t$host.escribe.com\n";
}

print @lines;

open FH, "> $HOSTS_FILE" or die "Could not write to $HOSTS_FILE";
print FH @lines;
close FH;
