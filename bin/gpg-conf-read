#!/usr/bin/perl
use strict;
use warnings;

my $usage = "Usage:
  $0 CONF_FILE [KEY_REGEX]
";

sub main(@){
  my $confFile = shift;
  my $keyRegex = shift;
  die $usage if @_ != 0 or not defined $confFile or not -f $confFile;
  my @lines = `cat $confFile`;
  for my $line(@lines){
    if($line =~ /^([^=]+?)\s*=\s*(.+)$/){
      my ($key, $val) = ($1, $2);
      if(defined $keyRegex and $key !~ /$keyRegex/i){
        next;
      }
      if($val =~ /^!h!.+!f!$/){
        $val = `gpg-sym '$val'`;
        chomp $val;
      }
      print "$key = $val\n";
    }else{
      print $line unless defined $keyRegex;
    }
  }
}

&main(@ARGV);
