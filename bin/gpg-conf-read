#!/usr/bin/perl
use strict;
use warnings;

my $usage = "Usage: $0 CONF_FILE\n";

sub main(@){
  die $usage if @_ != 1 or not -f $_[0];
  my $confFile = shift;
  my @lines = `cat $confFile`;
  for my $line(@lines){
    if($line =~ /^([^=]+\s*=\s*)(!h!.+!f!)$/){
      my ($prefix, $val) = ($1, $2);
      $val = `gpg-sym '$val'`;
      chomp $val;
      print "$prefix$val\n";
    }else{
      print $line;
    }
  }
}

&main(@ARGV);
