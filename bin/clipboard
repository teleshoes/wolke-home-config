#!/usr/bin/perl
use strict;
use warnings;
use File::Basename qw(basename);

my $EXEC = basename $0;

my $USAGE = "Usage:
  $EXEC -h|--help
    show this message

  $EXEC TEXT
    copy TEXT to clipboard using `xsel`

  $EXEC
    copy STDIN to clipboard using `xsel`
";

sub main(@){
  my $text = undef;
  while(@_ > 0){
    my $arg = shift @_;
    if($arg =~ /^(-h|--help)$/){
      print $USAGE;
      exit 0;
    }elsif(not defined $text){
      $text = $arg;
    }else{
      die $USAGE;
    }
  }

  if(defined $text){
    open FH, "|-", "xsel --input --clipboard" or die "ERROR: `xsel` failed\n$!\n";
    print FH $text;
    close FH;
  }else{
    exec "xsel --input --clipboard";
  }
}

&main(@ARGV);
