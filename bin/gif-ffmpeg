#!/usr/bin/perl
use strict;
use warnings;

sub main(@){
  my ($in, $out, $start, $dur, $width) = @_;
  my @cmd = ("ffmpeg", "-y", "-ss", $start, "-t", $dur,
     "-i", $in,
     "-filter_complex", (""
        . "fps=10,scale=$width:-1:flags=lanczos[x];[x]split[x1][x2];"
        . " [x1]palettegen[p];[x2][p]paletteuse"
      ),
      $out
  );
  print "@cmd\n";
  system @cmd;
  if($? != 0){
    die "ERROR: @cmd failed\n";
  }
}

&main(@ARGV);
