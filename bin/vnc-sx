#!/usr/bin/perl
use strict;
use warnings;
use Time::HiRes qw(sleep);

my $IPMAGIC_NAME = "sx";

sub main(@){
  system "ipmagic", $IPMAGIC_NAME, "-u", "root", "-s", "
    echo \"LIPSTICK2VNC_OPTS=\\\"--allow-all -s 0.8\\\"\" > /var/lib/environment/nemo/70-lipstick2vnc.conf
    lock --unlock &
    systemctl start vnc
  ";
  my $host = `ipmagic $IPMAGIC_NAME`;
  chomp $host;

  sleep 0.3;
  system "xtigervncviewer", $host;
  system "ipmagic", $IPMAGIC_NAME, "-u", "root", "-s", "systemctl stop vnc";
}

&main(@ARGV);
