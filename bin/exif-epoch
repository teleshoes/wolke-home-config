#!/usr/bin/perl
use strict;
use warnings;
use File::Basename qw(basename);

my $EXEC = basename $0;

my $USAGE = "Usage:
  $EXEC -h|--help
    show this message

  $EXEC FILE [FILE ..]
    extract UNIX epoch from each file using `exiftool -CreateDate -p -d %s`
      -tiny wrapper around `exiftool -p '\$CreateDate \$FileName' -d %s`
      -do not append 'FileName' if only one file is given
";

sub main(@){
  my @files;
  while(@_ > 0){
    my $arg = shift;
    if($arg =~ /^(-h|--help)$/){
      print $USAGE;
      exit 0;
    }elsif(-f $arg){
      push @files, $arg;
    }else{
      die "$USAGE\nERROR: unknown arg $arg\n";
    }
  }
  die "$USAGE\nERROR: no FILE given\n" if @files == 0;

  my $fmt = @files == 1 ? '$CreateDate' : '$CreateDate $FileName';
  system "exiftool",
    "-ignoreMinorErrors",
    "-q",
    "-d", "%s",
    "-p", $fmt,
    @files,
  ;
}

&main(@ARGV);
