#!/usr/bin/perl
use strict;
use warnings;

my $GST_LAUNCH_EXEC = "gst-launch-1.0";

my $usage = "Usage:
  $0 -h | --help
    show this message

  $0 WAV_FILE
    play WAV_FILE using $GST_LAUNCH_EXEC and pulse
";

sub main(@){
  my $wavFile;
  while(@_ > 0){
    my $arg = shift;
    if($arg =~ /^(-h|--help)$/){
      print $usage;
      exit 0;
    }elsif(-f $arg and $arg =~ /\.wav$/i){
      $wavFile = $arg;
    }else{
      die "$usage\nERROR: unknown arg $arg\n";
    }
  }

  my @cmd = (
    "gst-launch-1.0", "filesrc", "location=$wavFile",
    "!", "wavparse",
    "!", "audioconvert",
    "!", "audioresample",
    "!", "pulsesink",
  );
  print "@cmd\n";
  system @cmd;
}

&main(@ARGV);
