#!/usr/bin/perl
use strict;
use warnings;
use lib `dirname $0 | tr -d '\n'`;
use ScriptScript;

my $GIT_REPO = "https://github.com/anthwlock/untrunc";

my $UNTRUNC_EXEC_DEST = "/usr/local/bin/untrunc";

sub main(@) {
  die "Usage: $0\n" if @_ > 0;

  my $dir = getSrcCache() . "/untrunc";
  if(not -d $dir){
    run "git", "clone", $GIT_REPO, $dir;
  }

  run "make", "-C", $dir, "-j", "all";
  run "sudo", "rm", "-f", $UNTRUNC_EXEC_DEST;
  run "sudo", "cp", "-a", "$dir/untrunc", $UNTRUNC_EXEC_DEST;
}

&main(@ARGV);
