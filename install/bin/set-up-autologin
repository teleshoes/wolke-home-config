#!/usr/bin/perl
use strict;
use warnings;
use lib `dirname $0 | tr -d '\n'`;
use ScriptScript;

sub main(@) {
    getRoot @_;

    my $msg = ""
      . "====\n"
      . "DO NOT RUN THIS IN ANY DISPLAY MANAGER!\n"
      . "(including nodm)\n"
      . "====\n"
      ;
    print "\n\n\n$msg\nproceed? [Y/n] ";
    my $ok = <STDIN>;
    if($ok =~ /n|N/){
      print "aborting\n";
      exit 1;
    }

    my @dms = qw(nodm mdm gdm kdm lightdm slim wdm xdm sddm);
    my @extras = qw(.*liblightdm-gobject.* .*lightdm-gtk-greeter.*);
    tryrun qw(pkill -f), $_ foreach @dms;
    runAptGet qw(-y purge), @dms, @extras;

    runAptGet qw(-y install), "nodm";

    editSimpleConf "/etc/default/nodm", getUsername, {
      NODM_ENABLED => 'true',
      NODM_USER => getUsername,
      NODM_XSESSION => "\"/bin/bash -l -c $ENV{HOME}/.xinitrc\"",
      NODM_FIRST_VT => 7,
    };
}

main @ARGV;
